<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2018-12-13 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181213" />
    <meta http-equiv="Content-Language" content="en" />
    <title>DMPC-API : Le connecteur DMP par DEVCOOP &#x2013; </title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

          <meta name="author" content="DEVCOOP"/>
            <meta name="description" 
                  content="La DMPC-API est une interface de programmation écrite en Java, 
                        fournissant une abstraction de haut niveau permettant l exécution 
                        de l ensemble des transactions définies dans le cahier des charges 
                        pour la DMP Compatibilité. 
                        Elle facilite ainsi aux intégrateurs/éditeurs la mise en place des 
                        contraintes fortes imposées par l ASIP Santé pour la DMP Compatibilité."/>
                      </head>
        <body class="topBarEnabled">
          
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                                  <div class="container"><div class="nav-collapse">
            
                
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">DMPC <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../index.html"  title="Introduction">Introduction</a>
</li>
                  
                      <li>      <a href="../docReference.html"  title="Liens vers les documentations">Liens vers les documentations</a>
</li>
                  
                      <li>      <a href="../igc/migrationIGCSante.html"  title="Intégration nouvelle IGC Santé">Intégration nouvelle IGC Santé</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Embedded Client <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../embedded/firstStepEmbedded.html"  title="Commencer">Commencer</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Proxy <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../proxy-ws/firstStepProxyWS.html"  title="Proxy WS / Commencer">Proxy WS / Commencer</a>
</li>
                  
                      <li>      <a href="../proxy-ws/configurationServeurProxy.html"  title="Proxy WS / Configurer">Proxy WS / Configurer</a>
</li>
                  
                      <li>      <a href="../proxy-rest/todo.html"  title="Autres proxy">Autres proxy</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documents CDA <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../CDA/structurationMinimale.html"  title="Structuration Minimale">Structuration Minimale</a>
</li>
                  
                      <li>      <a href="../CDA/crBiologie.html"  title="CR Biologie">CR Biologie</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
                                                                            
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://www.devcoop.fr/" id="bannerLeft">
                                                                                        <img src="http://www.devcoop.fr/img/logo.png"  alt="DEVCOOP"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://www.devcoop.fr/" id="bannerRight">
                                                                                        <img src="http://www.devcoop.fr/img/fondBas.png"  alt="DMPC-API"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2018-12-13
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 3.0-SNAPSHOT
                      </li>
                      
              
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <div class="section">
<h2><a name="DMPC_Client_embedded"></a>DMPC Client embedded</h2>
<div class="section">
<h3><a name="Introduction"></a>Introduction</h3>
<p>La DMPC-API est une API Java qui peut &#xea;tre utilis&#xe9; dans un environnement <a class="externalLink" href="http://www.springframework.org">http://www.springframework.org</a>.</p></div>
<div class="section">
<h3><a name="Installation"></a>Installation</h3>
<p>l'utilisation de cette API ne n&#xe9;cessite pas d'installation. Il suffit d'ajouter les d&#xe9;pendances adequates dans votre projet Maven.</p>
<div class="source"><pre class="prettyprint linenums">&lt;dependency&gt;
    &lt;groupId&gt;fr.devcoop.dmpc&lt;/groupId&gt;
    &lt;artifactId&gt;dmpc-client-api&lt;/artifactId&gt;
    &lt;version&gt;2.0&lt;/version&gt;
    &lt;scope&gt;compile&lt;/scope&gt;   
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;fr.devcoop.dmpc&lt;/groupId&gt;
    &lt;artifactId&gt;dmpc-client-impl&lt;/artifactId&gt;
    &lt;version&gt;2.0&lt;/version&gt;
    &lt;scope&gt;runtime&lt;/scope&gt;   
&lt;/dependency&gt;
</pre></div>
<p>La javadoc est disponible ici :&#xa0;<a class="externalLink" href="http://devcoop.github.io/dmpc-public/apidocs/">http://devcoop.github.io/dmpc-public/apidocs/</a></p></div>
<div class="section">
<h3><a name="acrire_un_code_dexemple"></a>&#xc9;crire un code d'exemple</h3>
<div class="section">
<h4><a name="Initialisation_dun_DMPCClient"></a>Initialisation d'un DMPCClient</h4>
<p>La DMPC-API&#xa0;est une application spring, pour obtenir un client DMP, il faut injecter dans l'application la classe impl&#xe9;mentant l'interface <tt>DMPCClient</tt> par les m&#xe9;canismes CDI de spring.</p>
<div class="source"><pre class="prettyprint linenums">@Component
public class MonComposantDMP {

 @Autowired
    private DMPCClient client;
   
}
</pre></div></div>
<div class="section">
<h4><a name="Cration_des_objets_mtiers"></a>Cr&#xe9;ation des objets m&#xe9;tiers</h4>
<p>Afin de transmettre les m&#xe9;tadonn&#xe9;es n&#xe9;cessaires aux DMP pendant les diff&#xe9;rentes transactions, la DMPC-API contient un mod&#xe8;le m&#xe9;tier dont les classes principales suivantes :</p>
<ul>
<li><tt>DMPCCode</tt></li>
<li><tt>DMPCPersonnelSante</tt></li>
<li><tt>DMPCPatient</tt> </li>
<li><tt>DMPCDocument</tt></li>
<li><tt>DMPCSubmission</tt></li></ul>
<div class="section">
<h5><a name="DMPCCode"></a>DMPCCode</h5>
<p>Un <tt>DMPCCode</tt> est la structure de base pour toute codification. Une fois un <tt>DMPCClient</tt> initialis&#xe9;, il est possible d'obtenir toutes les nomenclatures standard depuis l'enum <tt>DMPCCode.ASIPJeuxValeurs</tt>.</p>
<p>Exemple de r&#xe9;cup&#xe9;ration d'un DMPCCode :</p>
<div class="source"><pre class="prettyprint linenums">// Je m'int&#xe9;resse &#xe0; la nomenclature SubjectRole

List&lt;DMPCCode&gt; roles = client.getCodesFor(DMPCCode.ASIPJeuxValeurs.SUBJECT_ROLE);
// liste de tous les codes SubjetRole
for (DMPCCode role : roles) {
    System.out.println(&quot;role :&quot; + role);
}
// le r&#xf4;le &quot;m&#xe9;decin&quot; est le 4&#xe8;me dans la nomenclature actuelle

assert &quot;m&#xe9;decin&quot;.equals(roles.get(3).getCode())

</pre></div></div>
<div class="section">
<h5><a name="DMPCPersonnelSante"></a>DMPCPersonnelSante</h5>
<p>Exemple d'initialisation d'un Personnel de Sant&#xe9;</p>
<div class="source"><pre class="prettyprint linenums">DMPCPersonnelSante ps1 = new DMPCPersonnelSante(123456, Durand, Pierre);
ps1.setRole(&quot;M&#xe9;decin&quot;); 
ps1.setSpecialite(&quot;G15_10/SM30&quot;); // c'est le 34&#xe8;me code : client.getCodesFor(DMPCCode.ASIPJeuxValeurs.AUTHOR_SPECIALITY).get(33).getCode() 
ps1.setSecteurActivite(&quot;Devcoop Bureau de L&#xe9;ognan&quot;); 
ps1.getStructureSante().setNom(&quot;SA43&quot;);  // Chercher dans l'annuaire de l'ASIP la valeur correspondant au certificat 
</pre></div></div>
<div class="section">
<h5><a name="DMPCPatient"></a>DMPCPatient</h5>
<p>Exemple d'initialisation d'un Patient</p>
<div class="source"><pre class="prettyprint linenums">DMPCPatient patient = new DMPCPatient();
patient.setInsc(insc);
patient.setNom(&quot;Lascar&quot;);
patient.setPrenom(&quot;Germain&quot;);
patient.setSexe(DMPCSexe.M);
patient.setTelephone(&quot;0987654321&quot;);
patient.setDateDeNaissance(&quot;20131212&quot;);
</pre></div></div>
<div class="section">
<h5><a name="DMPCDocument"></a>DMPCDocument</h5>
<p>Exemple d'initialisation d'un Document</p>
<div class="source"><pre class="prettyprint linenums">DMPCDocument document = new DMPCDocument();
document.setClassCode(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.CLASS_CODE).get(0).getCode());
document.addConfidentiality(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.CONFIDENTIALITY_CODE).get(0).getCode());
document.setComments(&quot;commentDocument&quot;);
document.addEvent(new DMPCCode(&quot;B18&quot;, &quot;2.16.840.1.113883.6.3&quot;, &quot;H&#xe9;patite virale chronique&quot;));
document.setPracticeSetting(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.PRACTICE_SETTING_CODE).get(0).getCode());
document.setServiceStartTime(&quot;20121020174600&quot;);
document.setServiceStopTime(&quot;20121020194600&quot;);
document.setTitle(&quot;titleDocument&quot;);
document.setType(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.TYPE_CODE).get(0).getCode());
document.setCreationTime(&quot;20121020194600&quot;);
return document;
</pre></div></div>
<div class="section">
<h5><a name="DMPCSubmission"></a>DMPCSubmission</h5>
<p>Une soumission peut contenir un ou plusieurs <tt>DMPCDocument</tt>.</p>
<p>Exemple d'initialisation d'une soumission</p>
<div class="source"><pre class="prettyprint linenums">DMPCSubmission template = new DMPCSubmission();
for (DMPCDocument currentDocument : documents) {
    template.addDocument(currentDocument);
}
template.setComments(&quot;Commentaire Soumission&quot;);
template.setContentType(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.CONTENT_TYPE_CODE).get(0).getCode());
template.setTitle(&quot;Soumission&quot;);
</pre></div></div></div>
<div class="section">
<h4><a name="Initialisation_du_contexte"></a>Initialisation du contexte </h4>
<p>L'API &#xe9;tant stateless un contexte doit &#xea;tre rappel&#xe9; pour chaque transaction vers le DMP. Un contexte peut &#xea;tre d&#xe9;finit de la mani&#xe8;re suivante :</p>
<div class="source"><pre class="prettyprint linenums">DMPCContext context = new DMPCContext();
DMPCPersonnelSante ps1 = // initialisation d'un personnel de sant&#xe9; responsable de la transaction vers le DMP
context.setAuthor(ps1);
</pre></div>
<p>Exemple d'utilisation du contexte dans le cadre d'un test d'existence</p>
<div class="source"><pre class="prettyprint linenums">
client.td02Exist(context, new TD02Request(patient));
        
</pre></div>
<div class="section">
<h5><a name="Transactions"></a>Transactions</h5>
<p>L'ensemble des transactions support&#xe9;es est d&#xe9;fini dans l'interface <tt>DMPCClient</tt> : <a class="externalLink" href="http://devcoop.github.io/dmpc-public/apidocs/fr/devcoop/dmpc/client/DMPCClient.html">http://devcoop.github.io/dmpc-public/apidocs/fr/devcoop/dmpc/client/DMPCClient.html</a></p>
<div class="source"><pre class="prettyprint linenums">package fr.devcoop.dmpc.client;

import fr.devcoop.dmpc.client.model.DMPCCode;
import java.util.List;

/**
 * Point d'entr&#xe9;e d'un client vers le proxy DMP. Toute requ&#xea;te sur ce proxy sera
 * interpr&#xe9;t&#xe9;e et transmise au DMP par la mise en place des diff&#xe9;rentes
 * exigences du [DMP1-DSFT] notamment la TD0.1 &#xa7;6.2.
 *
 * &lt;p&gt;
 * Le proxy a donc pour but de rendre transparent la mise en place de tous les
 * m&#xe9;canismes complexes induits par la s&#xe9;curisation des acc&#xe8;s et le respect des
 * standards exig&#xe9;s par le Cadre d'Int&#xe9;rop&#xe9;rabilit&#xe9; [CI-SIS].
 *
 * @author lforet
 */
public interface DMPCClient {

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;6.4 : Test l'existence du patient
     * dans le DMP,
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request insc doit &#xea;tre renseign&#xe9;
     * @return le patient retrouv&#xe9; dans le DMP permet de mettre en place
     * l'identitoVigilance d&#xe9;crite dans [DMP1-DSFT] &#xa7;7.1.1.3 le role de l'auteur
     * (l'&#xe9;tablissement de Sant&#xe9;) si autoris&#xe9; nul sinon (cf td03)
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel
     */
    public TD02Response td02Exist(DMPCContext context, TD02Request request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;6.5 : Demande d'ajout
     * d'autorisation d'acc&#xe8;s
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request le role doit &#xea;tre renseign&#xe9;
     * @return une r&#xe9;ponse vide
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD03Response td03AddAuthorization(DMPCContext context, TD03Request request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;6.5 : Demande de suppression
     * d'autorisation d'acc&#xe8;s
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request le role doit &#xea;tre renseign&#xe9;
     * @return une r&#xe9;ponse vide
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD03Response td03RemoveAuthorization(DMPCContext context, TD03Request request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;8.2 : Cr&#xe9;ation d&#x2019;un DMP
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request le patient &#xe0; cr&#xe9;er doit &#xea;tre renseign&#xe9;
     * @return une r&#xe9;ponse contenant le patient sauvegard&#xe9;
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD11Response td11CreationDmp(DMPCContext context, TD11Request request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;8.6 : Acc&#xe8;s Internet du Patient
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request contenant l'information patient et un canal OTP (One Time
     * Password)
     * @return les infos de connexions ainsi que le formulaire patient.
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD15aResponse td15aCreerAccesInternetPatient(DMPCContext context, TD15aRequest request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;8.6.4 : Ajout de canal Otp
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request contenant l'information patient et un canal OTP (One Time
     * Password)
     * @return une r&#xe9;ponse vide
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD15bResponse td15bAddCanalOTP(DMPCContext context, TD15bRequest request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;8.6.4 : Ajout de canal OTP
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request contenant l'information patient et un canal OTP (One Time
     * Password)
     * @return une r&#xe9;ponse vide
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD15bResponse td15bRemoveCanalOTP(DMPCContext context, TD15bRequest request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;8.6.6 : D&#xe9;blocage du compte
     * internet ou mise &#xe0; jour des codes internet.
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request contenant l'information patient et un canal OTP (One Time
     * Password)
     * @return les infos de connexions ainsi que le formulaire patient.
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD15cResponse td15dDeblocageAccesInternetPatient(DMPCContext context, TD15cRequest request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;9.2 : Soumission de documents
     *
     * Pr&#xe9;requis avoir obtenu l'autorisation d'acc&#xe8;s
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request contient une soumission qui contient des documents pour un
     * m&#xea;me patient.
     * @return la soumission compl&#xe9;t&#xe9; par des informations g&#xe9;r&#xe9;s par le proxy.
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD21Response td21SubmitDocuments(DMPCContext context, TD21Request request) throws DMPCProxyException;

    /**
     * Transaction d&#xe9;crite dans [DMP1-DSFT] &#xa7;9.4.4 : D&#xe9;publication de documents
     *
     * Pr&#xe9;requis avoir obtenu l'autorisation d'acc&#xe8;s
     *
     * @param context requis pour acc&#xe9;der &#xe0; la fonction
     * @param request contient l'uuid du document &#xe0; d&#xe9;publier
     * @return vide
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel.
     */
    public TD33CResponse td33cUnpublished(DMPCContext context, TD33CRequest request) throws DMPCProxyException;

    /**
     * Service permmettant de r&#xe9;cup&#xe9;rer les diff&#xe9;rents codes possible pour
     * l'ensemble des jeux de valeurs (nomenclatures) utilis&#xe9;s dans le cadre du
     * DMP.
     *
     * @see DMPCCode.ASIPJeuxValeurs
     * @param jeuxValeurs type de jeux de valeur souhait&#xe9;
     * @return la liste des codes correspondant au jeux de valeurs souhait&#xe9;s
     * @throws DMPCProxyException si probl&#xe8;me technique ou fonctionnel
     */
    public List&lt;DMPCCode&gt; getCodesFor(DMPCCode.ASIPJeuxValeurs jeuxValeurs) throws DMPCProxyException;
}

</pre></div></div></div></div>
<div class="section">
<h3><a name="Exemple_complet"></a>Exemple complet</h3>
<p>Cet exemple complet a permis de lancer les tests d'homologations aupr&#xe8;s de l'ASIP Sant&#xe9;.</p>
<div class="source"><pre class="prettyprint linenums">package fr.devcoop.dmpc.client.scenario;

import com.google.common.io.ByteStreams;
import fr.devcoop.dmpc.client.DMPCContext;
import fr.devcoop.dmpc.client.DMPCClient;
import fr.devcoop.dmpc.client.DMPCProxyException;
import fr.devcoop.dmpc.client.TD02Request;
import fr.devcoop.dmpc.client.TD02Response;
import fr.devcoop.dmpc.client.TD03Request;
import fr.devcoop.dmpc.client.TD21Request;
import fr.devcoop.dmpc.client.TD21Response;
import fr.devcoop.dmpc.client.TD33CRequest;
import fr.devcoop.dmpc.client.model.DMPCPersonnelSante;
import fr.devcoop.dmpc.client.model.DMPCCode;
import fr.devcoop.dmpc.client.model.DMPCDocument;
import fr.devcoop.dmpc.client.model.DMPCPatient;
import fr.devcoop.dmpc.client.model.DMPCRole;
import fr.devcoop.dmpc.client.model.DMPCSubmission;
import fr.devcoop.dmpc.client.model.biologie.DMPCDocumentCRBiologie;
import java.io.IOException;
import java.io.InputStream;
import javax.annotation.PostConstruct;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

/**
 *
 * @author lfo
 */
@Component
public class HomologationScenario {

    public static final String PS1_INTERNAL_ID = &quot;123456&quot;;
    public static final String PS1_LASTNAME = &quot;Durand&quot;;
    public static final String PS1_FIRSTNAME = &quot;Pierre&quot;;
    public static final String PS1_STRUCTURE_NOM = &quot;Devcoop Bureau de L&#xe9;ognan&quot;;
    public final static String PS1_STRUCTURE_SECTEUR_ACTIVITE = &quot;SA43&quot;;  // Chercher dans l'annuaire la valeur correspondant au certificat.
    
    public final static String PATIENT_016_ANNIE_HALL_INSC = &quot;1325378284605224901740&quot;;
    public final static String PATIENT_016_INTERNAL_ID = &quot;456&quot;;
    
    public final static String PATIENT_01_210_INSC = &quot;1263419912307032071237&quot;;
    public final static String PATIENT_01_210_INTERNAL_ID = &quot;789&quot;;
    public final static String PATIENT_001_INSC_INEXISTANT = &quot;0740724093302701701806&quot;;  // INS Valide et DMP inexistant
    public final static String PATIENT_002_INSC_FERME = &quot;1217293146690610585448&quot;;  // INS Valide et DMP ferm&#xe9;
    public final static String PATIENT_006_IRENE = &quot;1418878867934420256667&quot;;  // INS Valide et DMP ferm&#xe9;
    
    public final static String EUGENIE_MELANGE_INSC = &quot;0404312364978044945679&quot;;
    public final static String EUGENIE_MELANGE_INTERNAL_ID = &quot;012&quot;;
    public final static String BERTRAND_MELANGE_INSC = &quot;1284393474805047545376&quot;;
    public final static String BERTRAND_MELANGE_INTERNAL_ID = &quot;345&quot;;
    public final static String SEBASTIEN_MELANGE_INSC = &quot;0504592452383093073171&quot;;
    public final static String SEBASTIEN_MELANGE_INTERNAL_ID = &quot;678&quot;;
    
    @Autowired
    private DMPCClient client;
    @Autowired
    private DocumentFactory documentFactory;
    
    private DMPCContext context;
    private DMPCPersonnelSante ps1;
    private DMPCPatient patient016Annie;
    
    private DMPCDocument documentA;
    private DMPCDocument documentB;
    private DMPCDocument documentC;
    private DMPCDocument documentD;
    private DMPCDocument documentE;
    private DMPCDocument documentF;

    @PostConstruct
    public void init() throws DMPCProxyException {
        context = new DMPCContext();

        ps1 = new DMPCPersonnelSante(PS1_INTERNAL_ID, PS1_LASTNAME, PS1_FIRSTNAME);
        ps1.setRole(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.SUBJECT_ROLE).get(3).getCode()); // M&#xe9;decin       
        ps1.setSpecialite(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.AUTHOR_SPECIALITY).get(33).getCode()); // G15_10/SM30 N&#xe9;phrologie 
        ps1.setSecteurActivite(PS1_STRUCTURE_SECTEUR_ACTIVITE); 
        ps1.getStructureSante().setNom(PS1_STRUCTURE_NOM);
        context.setAuthor(ps1);
    }

    public void launchPrehomologation() throws DMPCProxyException, IOException {
        restore();
        test03_140();
        test02_100();
        test21_160();
        test21_200();
        test21_205();
        test33_450();
    }

    public void restore() {
        try {
            TD03Request td03Request = new TD03Request(PATIENT_016_ANNIE_HALL_INSC, DMPCRole.STANDARD);
            client.td03RemoveAuthorization(context, td03Request);
        } catch (DMPCProxyException ex) {
            System.out.println(&quot;Pas besoin de supprimer un role inexistant&quot;);
        }
    }

    public void test01_050() throws DMPCProxyException {
        System.out.println(&quot;---------------------- t01_050 --------------------&quot;);
        test02_100();
        System.out.println(&quot;---------------------- t01_050 Fin --------------------&quot;);
    }

    public void test01_210() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- t01_210 --------------------&quot;);
        final String insc = PATIENT_01_210_INSC;
        TD03Request td03Request = new TD03Request(insc, DMPCRole.STANDARD);
        client.td03AddAuthorization(context, td03Request);

        TD02Request td02request = new TD02Request(insc);
        TD02Response response = client.td02Exist(context, td02request);
        DMPCPatient patient = response.getPatient();
        patient.setInternalId(PATIENT_01_210_INTERNAL_ID);

        DMPCDocument document = createDocumentTemplate(&quot;DocumentSante.pdf&quot;);
        document.setTitle(&quot;DEVCOOP / DMPC-API / 2.0 / FORET&#xa0;Laurent&quot;);
        document.setType(&quot;11490-0&quot;);
        document.setClassCode(&quot;10&quot;);


        DMPCSubmission submission = createSubmissionTemplate(document);
        submission.setPatient(patient);
        submission.setComments(&quot;Commentaire Soumission du document test 01-210&quot;);
        submission.setTitle(&quot;Soumission du document test 01-210&quot;);

        TD21Request td21Request = new TD21Request(submission);
//        td21Request.setSubmission(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
        System.out.println(&quot;Soumission enregistr&#xe9; avec l'uuid :&quot; + td21Response.getSubmission().getUuid());

        for (DMPCDocument submittedDocument : td21Response.getSubmission().getDocuments()) {
            System.out.println(String.format(&quot;Contenant le document ayant pour uniqueId : %s et uuid : %s&quot;,
                    submittedDocument.getUniqueId(), submittedDocument.getEntryUuid()));
            documentA = submittedDocument;
        }
        System.out.println(&quot;---------------------- t01_210 FIN ----------------&quot;);
    }

    public void test02_080() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test02_080 --------------------&quot;);
        TD02Request td02request = new TD02Request(PATIENT_001_INSC_INEXISTANT);
        client.td02Exist(context, td02request);
        System.out.println(&quot;---------------------- test02_080 FIN ----------------&quot;);
    }

    public void test02_090() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test02_090 --------------------&quot;);
        TD02Request td02request = new TD02Request(PATIENT_002_INSC_FERME);
        client.td02Exist(context, td02request);
        System.out.println(&quot;---------------------- test02_090 FIN ----------------&quot;);
    }
    
    public void test02_100() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test02_100 --------------------&quot;);
        TD03Request td03Request = new TD03Request(PATIENT_016_ANNIE_HALL_INSC, DMPCRole.STANDARD);
        client.td03AddAuthorization(context, td03Request);
        TD02Request td02request = new TD02Request(PATIENT_016_ANNIE_HALL_INSC);
        TD02Response response = client.td02Exist(context, td02request);
        patient016Annie = response.getPatient();
        patient016Annie.setInternalId(PATIENT_016_INTERNAL_ID); // obligatoire pour une soumission de document

        System.out.println(&quot;---------------------- test02_100 FIN ----------------&quot;);
    }

    public void test03_140() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test03_140 --------------------&quot;);
        TD03Request td03Request = new TD03Request(PATIENT_006_IRENE, DMPCRole.STANDARD);
        client.td03AddAuthorization(context, td03Request);
        System.out.println(&quot;---------------------- test03_140 FIN ----------------&quot;);
    }

    public void test03_170() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test03_170 --------------------&quot;);
        TD03Request td03Request = new TD03Request(PATIENT_006_IRENE, DMPCRole.STANDARD);
        client.td03RemoveAuthorization(context, td03Request);
        System.out.println(&quot;---------------------- test03_170 FIN ----------------&quot;);
    }

    public void test03_200() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test03_200 --------------------&quot;);
        TD03Request td03Request = new TD03Request(PATIENT_002_INSC_FERME, DMPCRole.STANDARD);
        client.td03AddAuthorization(context, td03Request);
        System.out.println(&quot;---------------------- test03_200 FIN ----------------&quot;);
    }

    public void test21_160() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test21_160 --------------------&quot;);

        documentA = createDocumentTemplate(&quot;DocumentSante.pdf&quot;);
        documentA.setTitle(&quot;document A&quot;);
        documentA.setType(&quot;11490-0&quot;);


        DMPCSubmission submission = createSubmissionTemplate(documentA);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du document A&quot;);
        submission.setTitle(&quot;Soumission du document A&quot;);

        TD21Request td21Request = new TD21Request(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
        System.out.println(&quot;Soumission enregistr&#xe9; avec l'uuid :&quot; + td21Response.getSubmission().getUuid());

        for (DMPCDocument submittedDocument : td21Response.getSubmission().getDocuments()) {
            System.out.println(String.format(&quot;Contenant le document ayant pour uniqueId : %s et uuid : %s&quot;,
                    submittedDocument.getUniqueId(), submittedDocument.getEntryUuid()));
            documentA = submittedDocument;
        }
        System.out.println(&quot;---------------------- test21_160 FIN ----------------&quot;);
    }
    
    public void test21_160_Biologie() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test21_200 Biologie --------------------&quot;);
        final DMPCDocument documentTemplate = createDocumentTemplate();
        documentTemplate.setLegalAuthenticator(ps1);
        DMPCDocumentCRBiologie documentBiologie = documentFactory.createCRBiologie(documentTemplate);
        documentBiologie.setTitle(&quot;document CR Biologie&quot;);
        documentBiologie.setType(&quot;11502-2&quot;);

        DMPCSubmission submission = createSubmissionTemplate();
        submission.addCRBiologie(documentBiologie);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du document de Biologie&quot;);
        submission.setTitle(&quot;Soumission du document de CR Biologie&quot;);

        TD21Request td21Request = new TD21Request(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
        System.out.println(&quot;Soumission enregistr&#xe9; avec l'uuid :&quot; + td21Response.getSubmission().getUuid());
        for (DMPCDocument submittedDocument : td21Response.getSubmission().getDocuments()) {
            System.out.println(String.format(&quot;Contenant le document ayant pour uniqueId : %s et uuid : %s&quot;,
                    submittedDocument.getUniqueId(), submittedDocument.getEntryUuid()));
        }

        System.out.println(&quot;---------------------- test21_200 Biologie FIN ----------------&quot;);
    }

    public void test21_161() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test21_161 --------------------&quot;);
        DMPCDocument documentZ1 = createDocumentTemplate(&quot;DocumentSante.pdf&quot;, &quot;urn:ihe:iti:xds-sd:pdf:2008&quot;);
        documentZ1.setTitle(&quot;document Z1&quot;);
        documentZ1.setType(&quot;CERT_DECL&quot;);
        
        DMPCDocument documentZ2 = createDocumentTemplate(&quot;DocumentSante.txt&quot;, &quot;urn:ihe:iti:xds-sd:text:2008&quot;);
        documentZ2.setTitle(&quot;document Z2&quot;);
        documentZ2.setType(&quot;CERT_DECL&quot;);
        
        DMPCDocument documentZ3 = createDocumentTemplate(&quot;DocumentSante.rtf&quot;, &quot;urn:ihe:iti-fr:xds-sd:rtf:2010&quot;);
        documentZ3.setTitle(&quot;document Z3&quot;);
        documentZ3.setType(&quot;CERT_DECL&quot;);
                
        DMPCDocument documentZ4 = createDocumentTemplate(&quot;DocumentSante.jpg&quot;, &quot;urn:ihe:iti-fr:xds-sd:jpeg:2010&quot;);
        documentZ4.setTitle(&quot;document Z4&quot;);
        documentZ4.setType(&quot;CERT_DECL&quot;);
        
        DMPCDocument documentZ5 = createDocumentTemplate(&quot;DocumentSante.tiff&quot;, &quot;urn:ihe:iti-fr:xds-sd:tiff:2010&quot;);
        documentZ5.setTitle(&quot;document Z5&quot;);
        documentZ5.setType(&quot;CERT_DECL&quot;);


        DMPCSubmission submission = createSubmissionTemplate(documentZ1);
        submission.addDocument(documentZ2);
        submission.addDocument(documentZ3);
        submission.addDocument(documentZ4);
        submission.addDocument(documentZ5);
        
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du document O&quot;);
        submission.setTitle(&quot;Soumission du document O&quot;);

        TD21Request td21Request = new TD21Request(submission);
//        td21Request.setSubmission(submission);
        client.td21SubmitDocuments(context, td21Request);

        System.out.println(&quot;---------------------- test21_161 FIN ----------------&quot;);
    }

    public void test21_170() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test21_170 --------------------&quot;);

        documentB = createDocumentTemplate(&quot;DocumentB.txt&quot;, &quot;urn:ihe:iti:xds-sd:text:2008&quot;);
        documentB.setTitle(&quot;document B&quot;);
        documentB.setType(&quot;11490-0&quot;);
        documentB.setFormat(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.FORMAT_CODE).get(1).getCode());

        documentC = createDocumentTemplate(&quot;DocumentC.txt&quot;, &quot;urn:ihe:iti:xds-sd:text:2008&quot;);
        documentC.setTitle(&quot;document C&quot;);
        documentC.setType(&quot;11488-4&quot;);
        documentC.setFormat(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.FORMAT_CODE).get(1).getCode());

        DMPCSubmission submission = createSubmissionTemplate(documentB);
        submission.addDocument(documentC);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du documents B et C&quot;);
        submission.setTitle(&quot;Soumission du document B et C&quot;);

        TD21Request td21Request = new TD21Request(submission);
//        td21Request.setSubmission(submission);
        client.td21SubmitDocuments(context, td21Request);

        System.out.println(&quot;---------------------- test21_170 FIN ----------------&quot;);
    }

    public void test21_190() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test21_190 --------------------&quot;);
        documentD = createDocumentTemplate(&quot;DocumentSante.pdf&quot;);
        documentD.setTitle(&quot;document D&quot;);
        documentD.setType(&quot;34874-8&quot;);
        documentD.getConfidentialities().add(&quot;MASQUE_PS&quot;);

        DMPCSubmission submission = createSubmissionTemplate(documentD);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du document D&quot;);
        submission.setTitle(&quot;Soumission du document D&quot;);

        TD21Request td21Request = new TD21Request(submission);
        client.td21SubmitDocuments(context, td21Request);

        System.out.println(&quot;---------------------- test21_190 FIN ----------------&quot;);
    }

    public void test21_200() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test21_200 --------------------&quot;);
        documentE = createDocumentTemplate(&quot;DocumentSante.pdf&quot;);
        documentE.setTitle(&quot;document E&quot;);
        documentE.setType(&quot;11493-4&quot;);
        documentE.getConfidentialities().add(&quot;INVISIBLE_PATIENT&quot;);

        DMPCSubmission submission = createSubmissionTemplate(documentE);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du document E&quot;);
        submission.setTitle(&quot;Soumission du document E&quot;);

        TD21Request td21Request = new TD21Request(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
        System.out.println(&quot;Soumission enregistr&#xe9; avec l'uuid :&quot; + td21Response.getSubmission().getUuid());
        for (DMPCDocument submittedDocument : td21Response.getSubmission().getDocuments()) {
            System.out.println(String.format(&quot;Contenant le document ayant pour uniqueId : %s et uuid : %s&quot;,
                    submittedDocument.getUniqueId(), submittedDocument.getEntryUuid()));
            documentE = submittedDocument;
        }

        System.out.println(&quot;---------------------- test21_200 FIN ----------------&quot;);
    }

    
    public void test21_205() throws DMPCProxyException {
        System.out.println(&quot;---------------------- test21_205 --------------------&quot;);
        documentE.setTitle(&quot;document E remplac&#xe9;&quot;);
        documentE.setReplacementOf(documentE.getEntryUuid());
        documentE.setReplacementOfUniqueId(documentE.getUniqueId().toString());
        documentE.setEntryUuid(null);
        documentE.setUniqueId(null);


        DMPCSubmission submission = createSubmissionTemplate(documentE);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du remplacement de document E&quot;);
        submission.setTitle(&quot;Soumission du remplacement de document E&quot;);

        TD21Request td21Request = new TD21Request(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
        System.out.println(&quot;Soumission enregistr&#xe9; avec l'uuid :&quot; + td21Response.getSubmission().getUuid());
        for (DMPCDocument submittedDocument : td21Response.getSubmission().getDocuments()) {
            System.out.println(String.format(&quot;Contenant le document ayant pour uniqueId : %s et uuid : %s&quot;,
                    submittedDocument.getUniqueId(), submittedDocument.getEntryUuid()));
            documentE = submittedDocument;
        }
        System.out.println(&quot;---------------------- test21_205 FIN ----------------&quot;);
    }

    public void test21_410() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test21_419 --------------------&quot;);

        DMPCPatient eugenie = client.td02Exist(context, new TD02Request(EUGENIE_MELANGE_INSC)).getPatient();
        eugenie.setInternalId(EUGENIE_MELANGE_INTERNAL_ID);
        client.td03AddAuthorization(context, new TD03Request(eugenie.getInsc(), DMPCRole.STANDARD));

        DMPCPatient bertrand = client.td02Exist(context, new TD02Request(BERTRAND_MELANGE_INSC)).getPatient();
        bertrand.setInternalId(BERTRAND_MELANGE_INTERNAL_ID);
        client.td03AddAuthorization(context, new TD03Request(bertrand.getInsc(), DMPCRole.STANDARD));

        DMPCPatient sebastien = client.td02Exist(context, new TD02Request(SEBASTIEN_MELANGE_INSC)).getPatient();
        sebastien.setInternalId(SEBASTIEN_MELANGE_INTERNAL_ID);
        client.td03AddAuthorization(context, new TD03Request(sebastien.getInsc(), DMPCRole.STANDARD));
        
        submitDocument(&quot;document A - &quot;+ eugenie.getInsc(), eugenie);
        submitDocument(&quot;document B - &quot;+ bertrand.getInsc(), bertrand);
        submitDocument(&quot;document C - &quot;+ sebastien.getInsc(), sebastien);

        System.out.println(&quot;---------------------- test21_410 FIN ----------------&quot;);
    }

    public void test33_450() throws DMPCProxyException, IOException {
        System.out.println(&quot;---------------------- test33_450 --------------------&quot;);

        documentF = createDocumentTemplate(&quot;DocumentSante.pdf&quot;);
        documentF.setTitle(&quot;document F&quot;);
        documentF.setType(&quot;11505-5&quot;);


        DMPCSubmission submission = createSubmissionTemplate(documentF);
        submission.setPatient(patient016Annie);
        submission.setComments(&quot;Commentaire Soumission du document F&quot;);
        submission.setTitle(&quot;Soumission du document F&quot;);

        TD21Request td21Request = new TD21Request(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
        System.out.println(&quot;Soumission enregistr&#xe9; avec l'uuid :&quot; + td21Response.getSubmission().getUuid());

        for (DMPCDocument submittedDocument : td21Response.getSubmission().getDocuments()) {
            System.out.println(String.format(&quot;Contenant le document ayant pour uniqueId : %s et uuid : %s&quot;,
                    submittedDocument.getUniqueId(), submittedDocument.getEntryUuid()));
            documentF = submittedDocument;
        }

        TD33CRequest td33cRequest = new TD33CRequest();
        td33cRequest.setDocumentUuid(documentF.getEntryUuid());
        td33cRequest.setInsc(patient016Annie.getInsc()); // et il appartient au patient 
        td33cRequest.setContentType(submission.getContentType()); // le contentType est le m&#xea;me que pour une soumission de document.
        client.td33cUnpublished(context, td33cRequest);
        System.out.println(&quot;---------------------- test33_450 FIN ----------------&quot;);
    }

    private DMPCDocument createDocumentTemplate(String contentPath) throws DMPCProxyException, IOException {
        return createDocumentTemplate(contentPath, &quot;urn:ihe:iti:xds-sd:pdf:2008&quot;);
    }

    private DMPCDocument createDocumentTemplate(String contentPath, String formatCode) throws IOException, DMPCProxyException {
        DMPCDocument template = createDocumentTemplate();
        template.setFormat(formatCode);
        InputStream input = this.getClass().getClassLoader().getResourceAsStream(contentPath);
        byte[] content = new byte[input.available()];
        ByteStreams.readFully(input, content);
        template.setContent(content);
        return template;
    }    
    
    private DMPCDocument createDocumentTemplate() throws DMPCProxyException {
        DMPCDocument template = new DMPCDocument();
        template.setClassCode(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.CLASS_CODE).get(0).getCode());
        template.addConfidentiality(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.CONFIDENTIALITY_CODE).get(0).getCode());
        template.setComments(&quot;commentDocument&quot;);
        template.addEvent(new DMPCCode(&quot;B18&quot;, &quot;2.16.840.1.113883.6.3&quot;, &quot;H&#xe9;patite virale chronique&quot;));
        template.setPracticeSetting(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.PRACTICE_SETTING_CODE).get(0).getCode());
        template.setServiceStartTime(&quot;20121020174600&quot;);
        template.setServiceStopTime(&quot;20121020194600&quot;);
        template.setTitle(&quot;titleDocument&quot;);
        template.setType(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.TYPE_CODE).get(0).getCode());
        template.setCreationTime(&quot;20121020194600&quot;);
        return template;
    }
    
    private DMPCSubmission createSubmissionTemplate(DMPCDocument... documents) throws DMPCProxyException {
        DMPCSubmission template = new DMPCSubmission();
        for (DMPCDocument currentDocument : documents) {
            template.addDocument(currentDocument);
        }
        template.setComments(&quot;Commentaire Soumission&quot;);
        template.setContentType(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.CONTENT_TYPE_CODE).get(0).getCode());
        template.setTitle(&quot;Soumission&quot;);
        return template;
    }

    private void submitDocument(String title, DMPCPatient patient) throws DMPCProxyException, IOException {
        DMPCDocument document = createDocumentTemplate(&quot;DocumentSante.pdf&quot;);
        document.setTitle(title);
        
        DMPCSubmission submission = createSubmissionTemplate(document);
        submission.setPatient(patient);
        submission.setComments(&quot;Commentaire Soumission du &quot;+title);
        submission.setTitle(&quot;Soumission du &quot; + title);

        TD21Request td21Request = new TD21Request(submission);
        TD21Response td21Response = client.td21SubmitDocuments(context, td21Request);
    }

    
}


</pre></div></div></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
                      <div class="row">
                                      <p >Copyright &copy;                    2018
                        <a href="http://www.spring.io">Pivotal Software, Inc.</a>.
            All rights reserved.    
      </p>
                </div>

                <p id="poweredBy" class="pull-right">
                                                                                                                <a href="http://www.devcoop.fr/" title="DEVCOOP" class="builtBy">
        <img class="builtBy"  alt="DEVCOOP" src="http://www.devcoop.fr/img/logo.png"    />
      </a>
                  </p>
        
                </div>
    </footer>
        </body>
</html>
