<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.1 at 2020-02-24 
 | Rendered using Apache Maven Fluido Skin 1.5
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20200224" />
    <meta http-equiv="Content-Language" content="en" />
    <title>DMPC-API : Le connecteur DMP par DEVCOOP &#x2013; Les différentes transactions vers le DMP</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.5.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />

      
    <script type="text/javascript" src="../js/apache-maven-fluido-1.5.min.js"></script>

          <meta name="author" content="DEVCOOP"/>
            <meta name="description" 
                  content="La DMPC-API est une interface de programmation écrite en Java, 
                        fournissant une abstraction de haut niveau permettant l exécution 
                        de l ensemble des transactions définies dans le cahier des charges 
                        pour la DMP Compatibilité. 
                        Elle facilite ainsi aux intégrateurs/éditeurs la mise en place des 
                        contraintes fortes demandées pour la DMP Compatibilité."/>
                      </head>
        <body class="topBarEnabled">
          
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                                  <div class="container"><div class="nav-collapse">
            
                
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">DMPC <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../index.html"  title="Introduction">Introduction</a>
</li>
                  
                      <li>      <a href="../igc/certificatIGCSante.html"  title="Certificats serveurs IGC Santé">Certificats serveurs IGC Santé</a>
</li>
                  
                      <li>      <a href="../docReference.html"  title="Liens vers les documentations">Liens vers les documentations</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Embedded Client <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../embedded/firstStepEmbedded.html"  title="Commencer">Commencer</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Proxy <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../proxy-ws/firstStepProxyWS.html"  title="Proxy WS / Commencer">Proxy WS / Commencer</a>
</li>
                  
                      <li>      <a href="../proxy-ws/configurationServeurProxy.html"  title="Proxy WS / Configurer">Proxy WS / Configurer</a>
</li>
                  
                      <li>      <a href="../proxy-rest/todo.html"  title="Autres proxy">Autres proxy</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Documents CDA <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../CDA/structurationMinimale.html"  title="Structuration Minimale">Structuration Minimale</a>
</li>
                  
                      <li>      <a href="../CDA/crBiologie.html"  title="CR Biologie">CR Biologie</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
                                                                            
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                    <a href="http://www.devcoop.fr/" id="bannerLeft">
                                                                                        <img src="http://www.devcoop.fr/img/logo.png"  alt="DEVCOOP"/>
                </a>
                      </div>
        <div class="pull-right">                  <a href="http://www.devcoop.fr/" id="bannerRight">
                                                                                        <img src="http://www.devcoop.fr/img/fondBas.png"  alt="DMPC-API"/>
                </a>
      </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
              
                  <li id="publishDate">Last Published: 2020-02-24
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 3.1-SNAPSHOT
                      </li>
                      
              
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            <h1>Les diff&#xe9;rentes transactions vers le DMP</h1>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Toutes transactions vers le DMP&#xa0;se fait en pr&#xe9;cisant un `DMPCContext` et une requ&#xea;te sp&#xe9;cifique en argument d'une m&#xe9;thode du `DMPCClient`.
</pre></div></div>
<p>Le <tt>DMPCContext</tt> contient les informations permettant de d&#xe9;finir :&#xa0;  * L&#x2019;auteur de la transaction,  * Le code de confidentialit&#xe9; de la transaction (connexion secr&#xe8;te, invisible aux repr&#xe9;sentants l&#xe9;gaux du patient)  * L&#x2019;autorit&#xe9; des cartes vitales utilis&#xe9;es (r&#xe9;elles ou test)</p>
<p>&#xc0; ce <tt>DMPCContext</tt> est associ&#xe9; un autre argument d&#xe9;pendant de la transaction r&#xe9;alis&#xe9;e.</p>
<div class="section">
<h2><a name="Mode_dauthentification"></a>Mode d&#x2019;authentification</h2>
<div class="section">
<h3><a name="directe_since_version_3.1_de_la_DMPC-API"></a>directe (@since version 3.1 de la DMPC-API)</h3>

<div class="source">
<div class="source"><pre class="prettyprint linenums">En authentification directe, l'utilisateur personnel de sant&#xe9; est authentifi&#xe9; par sa carte CPS/CPE, ces informations sont r&#xe9;cup&#xe9;r&#xe9;s lors de la lecture de la carte CPS.
</pre></div></div></div>
<div class="section">
<h3><a name="indirecte"></a>indirecte</h3>

<div class="source">
<div class="source"><pre class="prettyprint linenums">En authentification indirecte, seule la structure de sant&#xe9; (par son certificat serveur) est authentifi&#xe9;e.
</pre></div></div>
<p>L&#x2019;auteur de la requ&#xea;te, c&#x2019;est &#xe0; dire le personnel de sant&#xe9; utilisateur (<tt>DMPCPersonnelSante</tt>), doit donc &#xea;tre authentifi&#xe9; localement. Le syst&#xe8;me de la structure de sant&#xe9; doit &#xea;tre en mesure d&#x2019;authentifi&#xe9; ses utilisateurs. Cet identifiant local au syst&#xe8;me doit &#xea;tre sp&#xe9;cifi&#xe9; dans <tt>DMPCPersonnelSante.internalId</tt> m&#xea;me si le rpps est connu.</p>
<p>Exemple : </p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">DMPCContext context = new DMPCContext();
DMPCPersonnelSante ps = new DMPCPersonnelSante();
ps.setInternalId(&quot;1234567890&quot;);
ps.setNom(&quot;For&#xea;t&quot;);
ps.setPrenom(&quot;Laurent&quot;);
ps.setRole(&quot;10&quot;); // M&#xe9;decin  dans la nomenclature DMPCCode.ASIPJeuxValeurs.SUBJECT_ROLE      
ps.setSpecialite(&quot;G15_10/SM30&quot;); // G15_10/SM30 N&#xe9;phrologie  dans la nomenclature DMPCCode.ASIPJeuxValeurs.AUTHOR_SPECIALITY
ps.setSecteurActivite(&quot;SA01&quot;);  // Etablissement public de sant&#xe9; dans la nomenclature DMPCCode.ASIPJeuxValeurs.HEALTH_CARE_FACILITY_TYPE_CODE
ps.getStructureSante().setNom(&quot;DEVCOOP Bureau de L&#xe9;ognan&quot;);
context.setAuthor(ps);
</pre></div></div></div></div>
<div class="section">
<h2><a name="aRcupration_des_diffrents_paramtres_du_DMP"></a>&#xa0;R&#xe9;cup&#xe9;ration des diff&#xe9;rents param&#xe8;tres du DMP</h2>
<div class="section">
<h3><a name="getParametres"></a>getParametres()</h3>
<p>Afin de pouvoir r&#xe9;cup&#xe9;rer le param&#xe8;trage du DMP qui permet de r&#xe9;pondre a un certains nombres d&#x2019;exigences notamment la fonctions-gestion-mineurs (EX_GEN-1550). Il faut acc&#xe9;der &#xe0; la m&#xe9;thode <tt>getParametres</tt></p>
<p>Exemple : </p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">  DMPCParametres parametres = dmpcClient.getParametres();

  if (parametres.isFonctionsGestionMineurs() &amp;&amp; agePatient &lt; parametres.getAgeMajorite()) {
    // Attention EX_GEN-1550
  } 
  if (parametres.isProduction()) {
    // Attention l'environnement est celui de production, 
  }
   
  if (!parametres.isCumulInvisiblePatientMasquePs()) {
   // Attention EX_2.1-1050
  }
</pre></div></div></div>
<div class="section">
<h3><a name="getCodesFor"></a>getCodesFor()</h3>
<p>M&#xe9;thode permettant d&#x2019;acc&#xe9;der aux diff&#xe9;rents jeux de valeurs impos&#xe9;s par le Guide d&#x2019;int&#xe9;gration.</p>
<p>notamment :&#xa0; ``` public enum ASIPJeuxValeurs {</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">    QUALITE_REPRESENTANT_LEGAL,
    AUTHOR_SPECIALITY,
    CLASS_CODE,
    CONFIDENTIALITY_CODE,
    CONTENT_TYPE_CODE,
    FORMAT_CODE,
    HEALTH_CARE_FACILITY_TYPE_CODE,
    PRACTICE_SETTING_CODE,
    SUBJECT_ROLE,
    TYPE_CODE,
    RESTRICTION_AUDIENCE_VIHF
}
</pre></div></div>

<div class="source">
<div class="source"><pre class="prettyprint linenums">Exemple :

</pre></div></div>

<div class="source">
<div class="source"><pre class="prettyprint linenums">List&lt;DMPCCode&gt; allPersonnelDeSanteSpecialities = client.getCodesFor(DMPCCode.ASIPJeuxValeurs.AUTHOR_SPECIALITY);
List&lt;DMPCCode&gt; allPossibleFormatCodesForADocument = client.getCodesFor(DMPCCode.ASIPJeuxValeurs.FORMAT_CODE);
</pre></div></div>

<div class="source">
<div class="source"><pre class="prettyprint linenums">## Transactions d'identification du patient 


### TD 0.0 :&#xa0;Acquisition de l'identit&#xe9; du patient

 Cette fonctionnalit&#xe9; permet au LPS d&#x2019;acqu&#xe9;rir l&#x2019;identit&#xe9; du patient et de d&#xe9;clencher les m&#xe9;canismes d&#x2019;identito-vigilance.
Avant le premier acc&#xe8;s au DMP d&#x2019;un patient via les interfaces LPS v2 du syst&#xe8;me DMP, le LPS :
 * acquiert l&#x2019;INS et les traits d&#x2019;identit&#xe9; du patient (cf. RG_0110) via la transaction TD0.0,
 * d&#xe9;clenche les m&#xe9;canismes d&#x2019;identito-vigilance en utilisant les donn&#xe9;es d&#x2019;identification du patient fournies par la transaction TD0.0 (cf. RG_0130).
 * d&#xe9;termine le statut de l&#x2019;INS du patient (cf. RG_0140).

Pour les acc&#xe8;s suivants, le LPS acquiert l&#x2019;INS du patient stock&#xe9; en base locale.

Exemple :&#xa0;

</pre></div></div>
<p>final TD00Request td00Request = new TD00Request(); td00Request.setDateNaissance(&#x201c;2011-06-07&#x201d;); td00Request.setNirOuvrantDroit(new DMPCNir(&#x201c;211066322074514&#x201d;)); td00Request.setNirIndividu(new DMPCNir(&#x201c;150060475546974&#x201d;)); final TD00Response td00Response = client.td00Identity(context, td00Request); if (td00Response == null) {  throw new RuntimeException(&#x201c;L&#x2019;ayant droit n&#x2019;existe pas&#x201d;); } ```</p></div>
<div class="section">
<h3><a name="TD0.2_:_test_dexistence_du_DMP_dun_patient_et_vrification_de_lautorisation_daccs"></a>TD0.2 : test d&#x2019;existence du DMP d&#x2019;un patient et v&#xe9;rification de l&#x2019;autorisation d&#x2019;acc&#xe8;s</h3>
<p>Cette transaction permet de tester l&#x2019;existence d&#x2019;un DMP et de v&#xe9;rifier les autorisations d&#x2019;acc&#xe8;s ainsi que de r&#xe9;cup&#xe9;rer les informations concernant la cr&#xe9;ation du compte patient.</p>
<p>De l&#xe0; peut en d&#xe9;couler des actions de cr&#xe9;ations de DMP, de cr&#xe9;ation de compte internet, ou bien encore de conna&#xee;tre la raison d&#x2019;une interdiction d&#x2019;acc&#xe8;s</p>
<p>Exemple : </p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">TD02Response response = client.td02Exist(context, new TD02Request(&quot;211066322074514&quot;));
if (response.getAutorisation().equals(EXPIRE)) {
    // pr&#xe9;voir une client.td03AddAuthorization()
} else if (response.getAutorisation().equals(INTERDIT)) {
    // le PS&#xa0;ne peut acc&#xe9;der au DMP
    final String raison = response.getRaison();
} else if (response.getAutorisation().equals(NON_EXISTE)) {
    // pr&#xe9;voir une client.td11CreationDmp()
} else if (response.getAutorisation().equals(VALIDE)) {
    if (!response.getCompteInternetOuvert()) {
        // pr&#xe9;vour une client.td15aCreerAccesInternetPatient()
    }
    // contient les informations patient stock&#xe9;es dans leDMP
    final DMPCPatient dmpPatient = response.getPatient();
    if (response.getRole().equals(DMPCRole.MEDECIN_TRAITANT)) {
        // le PS author est le m&#xe9;decint traitant
    } 
}
</pre></div></div></div>
<div class="section">
<h3><a name="TD0.3_:modifier_lautorisation_daccs_etou_le_statut_mdecin_traitant_DMP_via_TD0.3_ou_passer_en_mode_daccs__bris_de_glace_"></a>TD0.3 :&#xa0;modifier l&#x2019;autorisation d&#x2019;acc&#xe8;s et/ou le statut m&#xe9;decin traitant DMP (via TD0.3) ou passer en mode d&#x2019;acc&#xe8;s &#xab; bris de glace &#xbb;</h3>
<p>Le LPS permet &#xe0; l&#x2019;utilisateur les actions suivantes.  * Ajouter une autorisation d&#x2019;acc&#xe8;s au DMP du patient ou passer en mode d&#x2019;acc&#xe8;s &#xab; bris de glace &#xbb;. Cf. DMP_0.3a.  * Supprimer une autorisation d&#x2019;acc&#xe8;s au DMP du patient. Cf. DMP_0.3b.  * Modifier le statut m&#xe9;decin traitant DMP. Cf. DMP_0.3c.</p>
<p>Exemple :&#xa0;</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">client.td03AddAuthorization(context, new TD03Request(&quot;211066322074514&quot;, DMPCRole.STANDARD));
client.td03RemoveAuthorization(context, new TD03Request(patient.getIns(), DMPCRole.STANDARD));
client.td03AddAuthorization(context, new TD03Request(patient.getIns(), DMPCRole.MEDECIN_TRAITANT));
</pre></div></div></div>
<div class="section">
<h3><a name="TD0.4"></a>TD0.4</h3>
<p>Non requis pour le DMP</p></div>
<div class="section">
<h3><a name="TD0.5"></a>TD0.5</h3>
<p>Non requis pour le DMP</p></div>
<div class="section">
<h3><a name="TD1.1_:_crer_un_DMP"></a>TD1.1 : cr&#xe9;er un DMP</h3>
<p>Cette fonctionnalit&#xe9; permet de cr&#xe9;er le DMP d&#x2019;un patient. Le LPS : * contr&#xf4;le les pr&#xe9;requis &#xe0; la cr&#xe9;ation du DMP du patient (cf. RG_1010), * acquiert les donn&#xe9;es administratives du patient (cf. RG_1020), * acquiert le statut du DMP &#xe0; cr&#xe9;er (cf. RG_1030), * acquiert l&#x2019;adresse postale du patient (cf. RG_1040), * acquiert la date de naissance du patient (cf. RG_1050), * acquiert les donn&#xe9;es concernant le repr&#xe9;sentant l&#xe9;gal du patient (cf. RG_1060), * acquiert le consentement du patient &#xe0; la cr&#xe9;ation de son DMP (cf. RG_1070), * acquiert la demande d&#x2019;ajout du statut m&#xe9;decin traitant DMP (cf. RG_1080), * acquiert le consentement du patient &#xe0; l&#x2019;acc&#xe8;s &#xe0; son DMP en mode &#xab; bris de glace &#xbb; et en mode &#xab; centre de r&#xe9;gulation &#xbb; (cf. RG_1090), * cr&#xe9;e le DMP du patient (cf. RG_1100 et TD1.1), * ajoute statut m&#xe9;decin traitant DMP (cf. RG_1110 et TD0.3), * acquiert la demande d&#x2019;activation du compte internet du patient ou d&#xe9;clenche automatiquement l&#x2019;activation du compte internet du patient (cf. RG_1120), * G&#xe9;n&#xe9;re un &#xab; document d&#x2019;accus&#xe9; de cr&#xe9;ation du DMP &#xbb; en l&#x2019;absence d&#x2019;activation du compte internet du patient (cf. RG_1130).</p>
<p>Exemple : </p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">// td00&#xa0;requise avant cr&#xe9;ation d'un DMP
final TD00Request td00Request = new TD00Request();
td00Request.setDateNaissance(&quot;2011-06-07&quot;);
td00Request.setNirOuvrantDroit(new DMPCNir(&quot;211066322074514&quot;));
td00Request.setNirIndividu(new DMPCNir(&quot;150060475546974&quot;));
final TD00Response td00Response = client.td00Identity(context, td00Request);
if (td00Response == null) {
    throw new RuntimeException(&quot;L'ayant droit n'existe pas&quot;);
}

final DMPCCarteVitaleInfo carteVitaleInfo = new DMPCCarteVitaleInfo();
carteVitaleInfo.setDateNaissance(td00Response.getInfoPatient().getDateNaissance().substring(2));
carteVitaleInfo.setNomPatronymique(td00Response.getInfoPatient().getNomPatronymique());
carteVitaleInfo.setNomUsuel(td00Response.getInfoPatient().getNomPatronymique());
carteVitaleInfo.setPrenom(td00Response.getInfoPatient().getPrenom());

TD11Request td11Request = new TD11Request();
td11Request.setCarteVitaleInfo(carteVitaleInfo);

patient.setOrdreDeNaissance(1);
patient.setNomUsuel(&quot;PATB-TROIS&quot;);

final DMPCAdresse adresse = new DMPCAdresse();
adresse.setCodePostal(&quot;33850&quot;);
adresse.setLigneAdresse(&quot;22 rue des &#xe9;delweiss&quot;);
adresse.setComplementAdresse(&quot;compl&#xe9;ment d'adresse&quot;);
adresse.setVille(&quot;LEOGNAN&quot;);
adresse.setPays(&quot;FRANCE&quot;);
patient.setAdresse(adresse);
patient.setCivilite(&quot;M&quot;);
patient.setEmail(&quot;PATB-TROIS@devcoop.fr&quot;);
patient.setMobile(&quot;0663285980&quot;);
patient.setPaysDeNaissance(&quot;FRANCE&quot;);
patient.setSexe(DMPCSexe.M);
patient.setTelephone(&quot;0663285980&quot;);
final DMPCRepresentantLegal representantLegal = new DMPCRepresentantLegal();
representantLegal.setAdresse(adresse);
representantLegal.setCivilite(&quot;M&quot;);
representantLegal.setEmail(&quot;PATB-TROIS-REPRESENTANT@devcoop.fr&quot;);
representantLegal.setMobile(&quot;0663285980&quot;);
representantLegal.setTelephone(&quot;0663285980&quot;);
representantLegal.setNom(patient.getNomPatronymique());
representantLegal.setPrenom(&quot;Representant Legal&quot;);
representantLegal.setQualite(client.getCodesFor(DMPCCode.ASIPJeuxValeurs.QUALITE_REPRESENTANT_LEGAL).get(1).getCode());
patient.setRepresentantLegal(representantLegal);
td11Request.setPatient(patient);
td11Request.setConsentementOuverture(true);
td11Request.setOppositionBrisDeGlace(false);
td11Request.setOppositionUrgence(true);

final TD11Response td11Response = client.td11CreationDmp(context, td11Request);
final DMPCPatient dmpPatient = td11Response.getPatient(); // patient retourn&#xe9; par le DMP
Files.write(td11Response.getFormulairePatient(), new File(&quot;./documentDesSecrets.pdf&quot;)); // fichier PDF contenant le document des secrets
</pre></div></div></div></div>
                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
                      <div class="row">
                                      <p >Copyright &copy;                    2020
                        <a href="https://www.spring.io">Pivotal Software, Inc.</a>.
            All rights reserved.    
      </p>
                </div>

                <p id="poweredBy" class="pull-right">
                                                                                                                <a href="http://www.devcoop.fr/" title="DEVCOOP" class="builtBy">
        <img class="builtBy"  alt="DEVCOOP" src="http://www.devcoop.fr/img/logo.png"    />
      </a>
                  </p>
        
                </div>
    </footer>
        </body>
</html>
