<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 at 2021-04-17 
 | Rendered using Apache Maven Fluido Skin 1.6
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20210417" />
    <meta http-equiv="Content-Language" content="en" />
    <title>DevBox-Santé DMP : Le connecteur DMP par DEVCOOP &#x2013; Obtention de certificats serveurs en authentification Indirecte</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.6.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
      <script type="text/javascript" src="../js/apache-maven-fluido-1.6.min.js"></script>
<meta name="author" content="DEVCOOP"/>
            <meta name="description" 
                  content="La DevBox-Santé DMP est une interface de programmation écrite en Java, 
                        fournissant une abstraction de haut niveau permettant l exécution 
                        de l ensemble des transactions définies dans le cahier des charges 
                        pour la DMP Compatibilité. 
                        Elle facilite ainsi aux intégrateurs/éditeurs la mise en place des 
                        contraintes fortes demandées pour la DMP Compatibilité. La DevBox-Santé DMP est un connecteur de la http://www.devbox-sante.fr
"/>
      </head>
    <body class="topBarDisabled">
      <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href="https://www.devbox-sante.fr/" id="bannerLeft"><img src="../devbox-sante-logo-for-whiteBg.svg"  alt="DevBox-Santé"/></a></div>
        <div class="pull-right"><a href="https://www.devbox-sante.fr/connecteurs/dmpc-api" id="bannerRight"><img src="../toolbox-devcoop-dmpc-api-logo.png"  alt="DevBox-Santé DMP"/></a></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2021-04-17<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 4.1-SNAPSHOT</li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
<ul class="nav nav-list">
          <li class="nav-header"></li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a>  </li>
          <li class="nav-header">Proxy REST</li>
    <li><a href="../proxy-rest/proxy-rest.html" title="Commancer"><span class="none"></span>Commancer</a>  </li>
    <li><a href="https://dmpc-demo.devbox-sante.fr/swagger-ui.html" class="externalLink" title="Démonstration"><span class="none"></span>Démonstration</a>  </li>
          <li class="nav-header">Embedded Client</li>
    <li><a href="../embedded/firstStepEmbedded.html" title="Commencer"><span class="none"></span>Commencer</a>  </li>
    <li><a href="../embedded/transactions.html" title="Transactions supportées"><span class="none"></span>Transactions supportées</a>  </li>
    <li><a href="../embedded/howtos/uniqueIdGenerator.html" title="Howto : UniqueId"><span class="none"></span>Howto : UniqueId</a>  </li>
          <li class="nav-header">Proxy WS</li>
    <li><a href="../proxy-ws/firstStepProxyWS.html" title="Proxy WS / Commencer"><span class="none"></span>Proxy WS / Commencer</a>  </li>
    <li><a href="../proxy-ws/configurationServeurProxy.html" title="Proxy WS / Configurer"><span class="none"></span>Proxy WS / Configurer</a>  </li>
          <li class="nav-header">Howtos</li>
    <li><a href="../howtos/schematron.html" title="Schematron"><span class="none"></span>Schematron</a>  </li>
    <li><a href="../howtos/certificatIGCSante.html" title="Obtenir des Certificats serveurs"><span class="none"></span>Obtenir des Certificats serveurs</a>  </li>
    <li><a href="../docReference.html" title="Liens vers les documentations"><span class="none"></span>Liens vers les documentations</a>  </li>
          <li class="nav-header">Documents CDA</li>
    <li><a href="../CDA/structurationMinimale.html" title="Structuration Minimale"><span class="none"></span>Structuration Minimale</a>  </li>
    <li><a href="../CDA/crBiologie.html" title="CR Biologie"><span class="none"></span>CR Biologie</a>  </li>
  </ul>
          <hr />
          <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
  <a href="https://www.devcoop.fr/" title="DevBox-Sante" class="builtBy"><img class="builtBy"  alt="DevBox-Sante" src="https://www.devcoop.fr/img/logo.png"    /></a>
              </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<h1>Obtention de certificats serveurs en authentification Indirecte</h1>
<p>Une nouvelle IGC Sant&#xe9; a &#xe9;t&#xe9; mise en place par la CNAMTS courant 2016 : <a class="externalLink" href="http://integrateurs-cps.asipsante.fr/IGC-Sante">http://integrateurs-cps.asipsante.fr/IGC-Sante</a></p>
<p>Afin d&#x2019;utiliser le connecteur DMPC-API en mode authentification indirecte, il vous faut obtenir des certificats serveurs provenant de cette autorit&#xe9;. Pour cel&#xe0; apr&#xe8;s avoir command&#xe9; des cartes CPS vous pouvez faire une demande &#xe0; partir d&#x2019;un t&#xe9;l&#xe9;service dont la proc&#xe9;dure est d&#xe9;crite ici.</p><section>
<h2><a name="Proc.C3.A9dure_pour_les_les_.C3.89tablissements"></a>Proc&#xe9;dure pour les les &#xc9;tablissements</h2>
<p>Pour obtenir, les certificats et cl&#xe9;s n&#xe9;cessaires pour la connexion au DMP en authentification indirecte, il faut que votre &#xe9;tablissement soit enregistr&#xe9; au FINESS (Fichier National des &#xc9;tablissements Sanitaires es Sociaux) :&#xa0;<a class="externalLink" href="http://finess.sante.gouv.fr/fininter/jsp/index.jsp">http://finess.sante.gouv.fr/fininter/jsp/index.jsp</a></p>
<p>Les personnes pouvant remplir les conditions d&#x2019;obtentions des certificats sont d&#xe9;crites dans le document de l&#x2019;ANS :&#xa0;<a class="externalLink" href="https://esante.gouv.fr/media/3827">Proc&#xe9;dure DMP - Structures salari&#xe9;es</a></p></section><section>
<h2><a name="Proc.C3.A9dure_Technique"></a>Proc&#xe9;dure Technique</h2>
<p>Il est possible de les commander sur un site web mis &#xe0; disposition par l&#x2019;ANS. Il s&#x2019;agit d&#x2019;un service permettant la commande de certificats et cartes :&#xa0;</p>
<p><a class="externalLink" href="https://pfc.eservices.esante.gouv.fr">https://pfc.eservices.esante.gouv.fr</a></p>
<p>Pour pouvoir y acc&#xe9;der il faut se connecter avec un lecteur de cartes CPS configur&#xe9; et une carte CPA autoris&#xe9;e au pr&#xe9;alable :</p>
<p><img src="./pfcngAccueil.PNG" alt="pfcng" /></p><section>
<h3><a name="Certificats_et_cl.C3.A9s_d.E2.80.99authentification"></a>Certificats et cl&#xe9;s d&#x2019;authentification</h3><section>
<h4><a name="Demander"></a>Demander</h4><section>
<h5><a name="a.C3.89tape_1:.C2.A0"></a>&#xc9;tape 1:&#xa0;</h5>
<p><img src="./pfcngDemandeStep1.PNG" alt="pfcng" /></p></section><section>
<h5><a name="a.C2.A0.C3.89tape_2:"></a>&#xa0;&#xc9;tape 2:</h5>
<p>RAS, il s&#x2019;agit d&#x2019;un &#xe9;cran de recherche pour les demandes ant&#xe9;rieures. Cliquer sur &#x201c;Demander un nouveau produit&#x201d;</p></section><section>
<h5><a name="a.C3.89tape_3:"></a>&#xc9;tape 3:</h5>
<p>Il faut renseigner :</p>
<ul>

<li>l&#x2019;usage :&#xa0;AUTH_CLI</li>
<li>le nom du service (nom du logiciel) qui va acc&#xe9;der au DMP,</li>
<li>son adresse email (utiliser plus tard pour envoyer une confirmation)</li>
</ul>
<p><img src="./pfcngDemandeStep3Auth.PNG" alt="pfcng" /></p></section><section>
<h5><a name="a.C3.89tape_4_:"></a>&#xc9;tape 4 :</h5>
<p><img src="./pfcngDemandeStep4GenerateCSR.PNG" alt="pfcng" /></p>
<p>Pour cette &#xe9;tape le plus simple est de g&#xe9;n&#xe9;rer la CSR&#xa0;sur le site, mais pas obligatoire.</p>
<ul>

<li>Saisir un mot de passe assez fort pour convenir au service, et sauvegarder le car il sera demand&#xe9; lors de la r&#xe9;cup&#xe9;ration du certificats P12, ainsi que pour configurer la DMPC-API.</li>
<li>Cliquer sur &#x201c;G&#xe9;n&#xe9;rer la CSR&#x201d;, puis &#x201c;Finaliser&#x201d;</li>
</ul></section><section>
<h5><a name="a.C3.89tape_5_:"></a>&#xc9;tape 5 :</h5>
<p>Vous recevez un email de confirmation de la demande &#xe0; l&#x2019;adresse (correspondant &#xe0; la carte CPS enregistr&#xe9;e, ou &#xe0; l&#x2019;email saisie &#xe0; l&#x2019;&#xe9;tape 3, TOCHECK) :</p>
<p><img src="./pfcngDemandeMailRecap.PNG" alt="pfcng" /></p></section></section><section>
<h4><a name="R.C3.A9cup.C3.A9rer"></a>R&#xe9;cup&#xe9;rer</h4>
<p>Vous recevez un deuxi&#xe8;me mail contenant un lien permettant de r&#xe9;cup&#xe9;rer le certificat sur ce m&#xea;me site.</p><section>
<h5><a name="a.C3.89tape_2:"></a>&#xc9;tape 2:</h5>
<p>Saisir un nouveau mot de passe pour les r&#xe9;vocations (non utilis&#xe9; dans l&#x2019;API)</p>
<ul>

<li>Finalisation</li>
</ul>
<p>Le certificat/cl&#xe9; (p12) a un nom qui doit ressembler &#xe0; asip-p12-EL-TEST-ORG-AUTH_CLI-20170603-173116.p12</p></section></section></section><section>
<h3><a name="Certificats_et_cl.C3.A9s_de_signature"></a>Certificats et cl&#xe9;s de signature</h3>
<p>Pour la signature, il faut faire une autre demande avec le m&#xea;me process, &#xe0; l&#x2019;exception de l&#x2019;&#xe9;tape 3 ou il faudra demander un certificat de signature : Usage SIGN</p>
<p><img src="./pfcngDemandeStep3Sign.PNG" alt="pfcng" /></p></section></section><section>
<h2><a name="Configuration_de_la_DMPC-API"></a>Configuration de la DMPC-API</h2>
<p>Le param&#xe8;trage de ces certificats pour la DMPC-API se trouve dans le <code>application.yml</code></p>
<ul>

<li>dmpc.url.prefix</li>
<li>dmpc.smime.p12.path</li>
<li>dmpc.smime.p12.password</li>
<li>dmpc.ssl.p12.path</li>
<li>dmpc.ssl.p12.password</li>
<li>dmpc.ssl.trust.path</li>
</ul>
<p>Exemple de configuration &#xe0; fournir :</p>

<div class="source">
<div class="source"><pre class="prettyprint linenums">dmpc:
   # informations relatives au certificat smime
    smime:
        p12: 
            path:
                #./smime.p12
                A_renseigner 
            password:
                A_renseigner
    # informations relatives au certificat ssl
    ssl:
        p12:
            path:
                #ssl.p12
                A_renseigner
            password:
                A_renseigner
        # Contient les certificats serveurs autoris&#xe9;s pour authentification mutuelle         
        trust:
            path:
                truststoreIgcSante-EL-ORG.jks
</pre></div></div></section>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2021.
All rights reserved.</p>
        </div>
        </div>
    </footer>
    </body>
</html>
